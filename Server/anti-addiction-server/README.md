# fcm-server

## 防沉迷规则
### 登录触发
| 用户类型 | 触发流程 | 触发器 | 文案反馈（线上版）|文案反馈（版署版）|
|  ----  | ----  | ----  | ----  |----  | 
| 未实名  | 非宵禁时段，登录成功|第一次登录（新账号）|title：健康游戏提示<br>description：您当前未提交实名信息，根据国家相关规定，您享有 60 分钟游戏体验时间。登记实名信息后可深度体验。<br>button 1：去实名<br>button 2：进入游戏|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。<br>button 1：去实名<br>button 2：进入游戏
| 未实名  | 非宵禁时段，登录成功|非第一次登录，且剩余时长 ＞ 0 |title：健康游戏提示<br>description：您当前未提交实名信息，游戏体验时间还剩余 {x} 分钟。登记实名信息后可深度体验。<br>button 1：去实名<br>button 2：进入游戏|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余 {x} 分钟。<br>button 1：去实名<br>button 2：进入游戏
| 未实名  | 非宵禁时段，登录成功|非第一次登录，且剩余时长 ≤ 0 |title：健康游戏提示<br>description：您的游戏体验时长已达 60 分钟。登记实名信息后可深度体验。<br>button 1：去实名<br>button 2：切换账号<br>button 3：退出游戏|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 { } 分钟上限，无法再进行游戏。<br>button 1：去实名<br>button 2：切换账号<br>button 3：退出游戏
| 未实名  | 宵禁时段，登录成功|每日 22:00-次日 8:00|(按照非宵禁时段的场景弹窗）|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。<br>button 1：退出游戏<br>button 2：切换账号
| 已实名且为未成年 | 非宵禁时段，登录成功（法定节假日180分钟，工作日90分钟）| 第一次登录 |(不需要弹窗，不限制，可正常游戏）|title：健康游戏提示<br>description：您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。您当前享有 { 这里根据节假日/非节假日总时长展示 } 分钟游戏时间，请注意适当休息。<br>button 1：进入游戏
| 已实名且为未成年  | 非宵禁时段，登录成功（法定节假日180分钟，工作日90分钟） |非第一次登录，且剩余时长 ＞ 0 | (不需要弹窗，不限制，可正常游戏）|title：健康游戏提示<br>description：您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余 { 这里根据节假日/非节假日总时长计算 } 分钟，请注意适当休息。<br>button 1：进入游戏
| 已实名且为未成年  | 非宵禁时段，登录成功（法定节假日180分钟，工作日90分钟） |非第一次登录，且剩余时长 ≤ 0 | title：健康游戏提示<br>description：您今日游戏时间已达  { 这里根据节假日/非节假日总时长展示 }  分钟。根据国家相关规定，今日无法再进行游戏。请注意适当休息。<br>button 1：退出游戏<br>button 2：切换账号|title：健康游戏提示<br>description：您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 { 这里根据节假日/非节假日总时长展示 } 分钟上限，无法再进行游戏。<br>button 1：退出游戏<br>button 2：切换账号
| 已实名且为未成年 |宵禁时段，登录成功| 每日 22:00-次日 8:00|title：健康游戏提示<br>description：根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前无法进入游戏。<br>button 1：退出游戏<br>button 2：切换账号|title：健康游戏提示<br>description：您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。<br>button 1：退出游戏<br>button 2：切换账号

###游戏中触发
注意1：当每日剩余时长 ≥ 即将到达宵禁时长，优先展示宵禁的提示文案

| 用户类型 | 触发流程 | 触发器 | 文案反馈（线上版）|文案反馈（版署版）|
|  ----  | ----  | ----  | ----  |----  | 
|未实名|游戏中，未宵禁|累计已玩的游戏时长 = 45 分钟（即，剩余时长= 15 分钟）|description：您的游戏体验时间还剩余 15 分钟，登记实名信息后可深度体验。|（同线上版）
|未实名|游戏中，未宵禁|累计已玩的游戏时长 = 60 分钟（即，剩余时长= 0 分钟）|title：健康游戏提示<br>description：您的游戏体验时间已达 60 分钟。登记实名信息后可深度体验。<br>button 1：去实名<br>button 2：退出游戏<br>button 3：切换账号|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 60 分钟上限，无法再进行游戏。<br>button 1：去实名<br>button 2：退出游戏<br>button 3：切换账号
|未实名|游戏中，到达宵禁时段|在游戏中，当日时间=21:45（即，距离宵禁还剩 15 分钟）|description：距离健康保护时间还剩余 15 分钟，请注意适当休息。|（同线上版）
|未实名|游戏中，到达宵禁时段|在游戏中，当日时间=22:00（即，距离宵禁还剩 0 分钟）|title：健康游戏提示<br>description：根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前无法进入游戏。<br>button 1：退出游戏<br>button 2：切换账号|title：健康游戏提示<br>description：您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。<br>button 1：退出游戏<br>button 2：切换账号
|已实名且为未成年|游戏中，未宵禁，非节假日（90 分钟），节假日（180 分钟）|非节假日：累计已玩的游戏时长 = 75 分钟（即，剩余时长= 15 分钟）；节假日：累计已玩的游戏时长 = 165 分钟（即，剩余时长= 15 分钟）|description：您今日游戏时间还剩余 15 分钟，请注意适当休息。|（同线上版）
|已实名且为未成年|游戏中，未宵禁，非节假日（90 分钟），节假日（180 分钟）|非节假日：累计已玩的游戏时长 = 90 分钟（即，剩余时长= 0 分钟）；节假日：累计已玩的游戏时长 = 180 分钟（即，剩余时长= 0 分钟）|title：健康游戏提示<br>description：您今日游戏时间已达  { 这里根据节假日/非节假日总时长展示 }  分钟。根据国家相关规定，今日无法再进行游戏。请注意适当休息。<br>button 1：退出游戏<br>button 2：切换账号|title：健康游戏提示<br>description：您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 { 这里根据节假日/非节假日总时长展示 } 分钟上限，无法再进行游戏。<br>button 1：退出游戏<br>button 2：切换账号
|已实名且为未成年|游戏中，到达宵禁时段|在游戏中，当日时间=21:45（即距离宵禁还剩 15 分钟）|title：无<br>description：距离健康保护时间还剩余 15 分钟，请注意适当休息。|（同线上版）
|已实名且为未成年|游戏中，到达宵禁时段|在游戏中，当日时间=22:00（即距离宵禁还剩 0 分钟）|title：健康游戏提示<br>description：根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前无法进入游戏。<br>button 1：退出游戏<br>button 2：切换账号|title：健康游戏提示<br>您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。<br>button 1：退出游戏<br>button 2：切换账号

###充值触发
| 用户类型 | 触发流程 | 触发器 | 文案反馈（线上版）|文案反馈（版署版）|
|  ----  | ----  | ----  | ----  |----  | 
|已实名：8 岁以下|充值付费|点击商品|title：健康消费提示<br>description：根据国家相关规定，当前您无法使用充值相关功能。<br>button 1：返回游戏|title：健康消费提示<br>description：当前账号未满 8 周岁，无法使用充值相关功能。<br>根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。<br>button 1：返回游戏
|已实名：8 - 16岁以下|充值付费|点击商品<br>商品金额 > 50 元|title：健康消费提示<br>description：根据国家相关规定，您本次付费金额超过规定上限，无法购买。请适度娱乐，理性消费。<br>button 1：返回游戏|title：健康消费提示<br>description：当前账号未满 16 周岁，本次单笔付费金额超过规定上限 50 元，无法购买。<br>根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。<br>button 1：返回游戏
|已实名：8 - 16岁以下|充值付费|点击商品<br>月累计金额+当前选择的充值项金额 > 200 元|title：健康消费提示<br>description：根据国家相关规定，您当月的剩余可用充值额度不足，无法购买此商品。请适度娱乐，理性消费。<br>button 1：返回游戏|title：健康消费提示<br>description：当前账号未满 16 周岁，购买此商品后，您当月交易的累计总额已达上限  200 元，无法购买。<br>根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。<br>button 1：返回游戏
|已实名：16 - 18岁以下|充值付费|点击商品<br>商品金额 > 100 元|title：健康消费提示<br>description：根据国家相关规定，您本次付费金额超过规定上限，无法购买。请适度娱乐，理性消费。<br>button 1：返回游戏|title：健康消费提示<br>description：当前账号未满 18 周岁，本次单笔付费金额超过规定上限 100 元，无法购买。<br>根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。<br>button 1：返回游戏
|已实名：16 - 18岁以下|充值付费|点击商品<br>月累计金额+当前选择的充值项金额 > 400 元|title：健康消费提示<br>description：根据国家相关规定，您当月的剩余可用充值额度不足，无法购买此商品。请适度娱乐，理性消费。<br>button 1：返回游戏|title：健康消费提示<br>description：当前账号未满 18 周岁，购买此商品后，您当月交易的累计总额已达上限  400 元，无法购买。<br>根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。<br>button 1：返回游戏

##API
###1.0获取防沉迷配置
>请求路由
```
请求方式：GET

/v3/fcm/get_config?game=ro
```

```
出参
//accout_type:0,实名类型 1：8岁以下 ，2：8-15岁，  3：16-17岁， 4：18+ 5：未实名
//type:1-宵禁剩余时间提示 2-时长剩余提示 3-单笔消费限制 4-月消费限制 5-已经处于宵禁提示 6-时长耗尽提示 7-非宵禁时段第一次登陆 8-非宵禁时段非第一次登陆,剩余时长大于0，9-非宵禁时段非第一次登陆,剩余时长小于等于0，10-宵禁时段，登陆成功 11-非第一次登录，且剩余时长＞0，且＜20min时 12-气泡剩余时长 13-气泡距离宵禁时间

{
    "code": 200,
    "msg": "",
    "data": {
        "child_protected_config": {
            "share_time_switch": 0,             // 分游戏计算时长，1:统一计算时长
            "use_time_switch": 1,               // 0:客户端时间 1:服务端时间
            "no_identify_time": 3600,           // 未实名用户娱乐时间，单位秒
            "charge_amount_switch": 1,          // 0:分游戏计算金额 1:统一计算金额
            "child_common_time": 5400,          // 娱乐时间，单位秒
            "child_holiday_time": 10800,        // 节假日娱乐时间，单位秒
            "night_strict_start": "22:00",      // 宵禁开始时间 | 格式:hh:mm | eg 20:00
            "night_strict_end": "08:00",        // 宵禁结束时间 | 格式:hh:mm | eg 08:00
            "night_strict_warn": 2400,          // 宵禁提前预警时间，单位秒
            "remain_time_warn": 1200,           // 剩余时间提前预警时间，单位秒
            "upload_all_data":0                 // 是否需要上传所有类型用户的数据，默认成年人不上传不计时
        },
        "ui_config": {
            "pay_limit_words": [
                {
                    "single_title": "健康消费提示",
                    "single_description": "当前账号未满 8 周岁，无法使用充值相关功能。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "single_limit": 0,//单位分
                    "account_type": 1,
                    "month_title": "健康消费提示",
                    "month_description": "当前账号未满 8 周岁，无法使用充值相关功能。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "month_limit": 0//单位分
                },
                {
                    "single_title": "健康消费提示",
                    "single_description": "当前账号未满 16 周岁，本次单笔付费金额超过规定上限 50 元，无法购买。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "single_limit": 20000,
                    "account_type": 2,
                    "month_title": "健康消费提示",
                    "month_description": "当前账号未满 16 周岁，购买此商品后，您当月交易的累计总额已达上限  200 元，无法购买。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "month_limit": 20000
                },
                {
                    "single_title": "健康消费提示",
                    "single_description": "当前账号未满 18 周岁，本次单笔付费金额超过规定上限 100 元，无法购买。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "single_limit": 40000,
                    "account_type": 3,
                    "month_title": "健康消费提示",
                    "month_description": "当前账号未满 18 周岁，购买此商品后，您当月交易的累计总额已达上限  400 元，无法购买。根据国家相关规定，未满8周岁：不提供付费服务；8-16周岁以下：单笔付费不超过50元，每月累计不超过200元；16-18周岁以下：单笔付费不超过100元，每月累计不超过400元。",
                    "month_limit": 40000
                }
            ],
            "health_reminder_words": [
                {
                    "account_type": 0,
                    "tips": [
                        {
                            "type": 1,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 5,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 2,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，游客账号享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟"
                        },
                        {
                            "type": 6,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，游客账号享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 60分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 7,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，游客账号享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。"
                        },
                        {
                            "type": 8,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，游客账号享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟。"
                        },
                        {
                            "type": 9,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，游客账号享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 60 分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 10,
                            "title": "健康游戏提示",
                            "description": "您当前为游客账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 12,
                            "title": "健康游戏提示",
                            "description": "您的游戏体验时间还剩余# ${remaining} #分钟，登记实名信息后可深度体验。"
                        },
                        {
                            "type": 13,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        }
                    ]
                },
                {
                    "account_type": 1,
                    "tips": [
                        {
                            "type": 1,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 5,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 2,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 6,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达# ${remaining} #分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 7,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。您当前享有# ${remaining} #分钟游戏时间，请注意适当休息。"
                        },
                        {
                            "type": 8,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 9,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，未成年账号非节假日每日游戏时长 1.5 小时，节假日每日游戏时长为 3 小时，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达# ${remaining} #分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 10,
                            "title": "健康游戏提示",
                            "description": "您当前为未成年账号，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 11,
                            "title": "健康游戏提示",
                            "description": "您今日游戏时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 12,
                            "title": "健康游戏提示",
                            "description": "您今日游戏时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 13,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        }
                    ]
                },
                {
                    "account_type": 5,
                    "tips": [
                        {
                            "type": 1,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        },
                        {
                            "type": 5,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 2,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟。"
                        },
                        {
                            "type": 6,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 ${remaining}分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 7,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。"
                        },
                        {
                            "type": 8,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间还剩余# ${remaining} #分钟。"
                        },
                        {
                            "type": 9,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。您享有 60 分钟游戏体验时间，且每日 22 点 - 次日 8 点为健康保护时段，不可进入游戏。该账号游戏体验时间已达 60 分钟上限，无法再进行游戏。"
                        },
                        {
                            "type": 10,
                            "title": "健康游戏提示",
                            "description": "您当前未提交实名信息，已被纳入防沉迷系统。根据国家相关规定，每日 22 点 - 次日 8 点为健康保护时段，当前不可进入游戏。"
                        },
                        {
                            "type": 12,
                            "title": "健康游戏提示",
                            "description": "您的游戏体验时间还剩余# ${remaining} #分钟，登记实名信息后可深度体验。"
                        },
                        {
                            "type": 13,
                            "title": "健康游戏提示",
                            "description": "距离健康保护时间还剩余# ${remaining} #分钟，请注意适当休息。"
                        }
                    ]
                }
            ]
        },
        "holiday": [
            "01.25",
            "01.26",
            "01.27",
            "01.01",
            "04.04",
            "05.01",
            "05.02",
            "05.03",
            "05.04",
            "05.05",
            "06.25",
            "10.01",
            "10.02",
            "10.03"
        ]
    }
}
```

###1.1授权
解密客户端传过来的token，保存用户到数据库，生成一个包含防沉迷系统用户id的jwt token 返回给客户端。

>请求路由
```
请求方式：POST-application/json

/v3/fcm/authorizations
```

|参数|类型|含义|是否必须|
|  ----  | ----  | ----  | ----  |
|game|string|游戏名称|Y|
|token|string|包含身份信息的token|Y|

```
入参
{"game":"ro","token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJiaXJ0aGRheSI6IjE5OTAtMDUtMDkiLCJ1bmlxdWVfaWQiOiIxNjQyZDlhMDBhMWM2YjA2NjY0ZjUzYjEwMjk0MTA5ZiIsInVzZXJfaWQiOiI3NmVhNzdmOWQ0ZTZkMjM2ZjhlMzFkMDc3NzEwNjAyMyJ9.EFxHmGiSTAn3ei1tCvaXw4Nfp51s_X0-NVRYX1lBtGw"}

出参
{
    "code": 200,
    "msg": "授权成功",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNzZlYTc3ZjlkNGU2ZDIzNmY4ZTMxZDA3NzcxMDYwMjMiLCJiaXJ0aGRheSI6IjE5OTAtMDUtMDkiLCJhY2NvdW50VHlwZSI6NCwiaWF0IjoxNjIzOTk5NzY2fQ.SMBqG90kS5H52KsMVgENw8K6eyKAE_Wtyrdns2oOJ78",
        "user_id": "76ea77f9d4e6d236f8e31d0777106023",
        "type": 4
    }
}
```

###1.2上传时长

>请求路由
```
请求方式：POST-application/json

/v3/fcm/set_play_log
```

|参数|类型|含义|是否必须|
|  ----  | ----  | ----  | ----  |
|game|string|游戏名称|Y|
|is_login|int|1:登录时调用  0：游戏中调用|Y|
|play_logs|json|时长json|Y|

```
入参
Authorization: Bearer <access_token>
{"play_logs":{"local_times":[],"server_times":[[1623749555,1623749655]]},"is_login":1,"game":"ro"}

出参
{
    "code": 200,
    "msg": "上传时间成功",
    "data": {
        "remainTime": 5203,//   防沉迷剩余时间，单位秒
        "costTime": 197,//  今日游戏已玩时长，单位秒
        "restrictType": 1,//0-不限制1-宵禁 2-时长
        "title": "实名的宵禁临近文案",
        "description": "距离健康保护时间还剩余14分钟，请注意适当休息。"
    }
}
```

###1.3充值检查
>请求路由
```
请求方式：POST-application/json

/v3/fcm/check_pay
```
|参数|类型|含义|是否必须|
|  ----  | ----  | ----  | ----  |
|game|string|游戏名称|Y|
|amount|int|单位（分）|Y|
```
入参
Authorization: Bearer <access_token>
{
    "game":"demo",
    "amount":4200
}

出参
{
    "code": 200,
    "msg": "限额提示",
    "data": {"status":true}
}
或
{
    "code": 9999,
    "msg": "限制消费",
    "data": {
        "title": "健康消费提醒",
        "description": "根据国家相关规定，您本次付费金额超过规定上限，无法购买。请适度娱乐，理性消费"
    }
}
```

###1.4服务端上传充值
>请求路由
```
请求方式：POST-application/json

/v3/fcm/check_pay
```
|参数|类型|含义|是否必须|
|  ----  | ----  | ----  | ----  |
|accessToken|string|附带充值记录的token|Y|

```
入参
{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfaWQiOiJjZjc4N2E3MzhmNjRjZjVjOTI0MDk5ZWI0MTBiNDgwYSIsImFtb3VudCI6NDAwMCwiZ2FtZSI6InJvIiwiaWF0IjoxNjI0MDA0MzA1fQ.GfOVtpVxcIGvgxHvmfRmKXR0lrndQyOYycTJPE8SqpA"}

出参
{
    "code": 200,
    "msg": "上传金额成功",
    "data": {}
}
```

## 生成环境变量和数据表

```bash
#配置数据库及jwt密钥
$ echo 'export DATASOURCE_HOST="127.0.0.1"' >> ~/.bash_profile
$ echo 'export DATASOURCE_PORT="3306"' >> ~/.bash_profile
$ echo 'export DATASOURCE_USER="root"' >> ~/.bash_profile
$ echo 'export DATASOURCE_PW="root"' >> ~/.bash_profile
$ echo 'export DATASOURCE_SCHEMA="fcm"' >> ~/.bash_profile
$ echo 'export JWS="!OKM9ijn"' >> ~/.bash_profile
$ source ~/.bash_profile
#进入主目录
$ cd anti-addiction-kit
#自动创建数据表
$ npx sequelize db:migrate --env "production"
```
## 部署
### Docker
```
$ cd Server/anti-addiction-server/
$ docker build -t anti-addiction-server .
#输出环境变量到env.list
$ env > env.list
#启动镜像
$ docker run -p 7001:7001 --env-file env.list anti-addiction-server
```

###命令行
```
$ cd Server/anti-addiction-server/
$ npm i
#启动项目
$ npm run start   
#关闭项目
$ npm run stop
```

###业务配置
```
用途：配置每年的法定节假日（法定节假日180分钟，工作日90分钟）

操作示例：插入2022年法定节假日配置，sql如下
INSERT INTO `fcm_game_holiday_json` VALUES (2, 'common', 2022, '{\"202201\":{\"01\":\"2\"},\"202202\":{\"01\":\"2\",\"02\":\"02\",\"03\":\"2\",\"04\":\"2\",\"05\":\"2\",\"06\":\"2\",\"07\":\"2\"},\"202204\":{\"05\":\"2\"},\"202105\":{\"01\":\"2\"},\"202206\":{\"03\":\"2\"},\"202209\":{\"10\":\"2\"},\"202110\":{\"01\":\"2\",\"02\":\"2\",\"03\":\"2\",\"04\":\"2\",\"05\":\"2\",\"06\":\"2\",\"07\":\"2\"}}');
```
